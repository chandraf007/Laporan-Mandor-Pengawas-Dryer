import React, { useState, useEffect } from â€˜reactâ€™;

const DryerReportApp = () => {
const [page, setPage] = useState(â€˜dashboardâ€™);
const [machine, setMachine] = useState(null);
const [role, setRole] = useState(â€˜mandorâ€™);
const [data, setData] = useState({});
const [qcData, setQcData] = useState({});

const machines = [â€˜D-01â€™, â€˜D-02â€™, â€˜D-03â€™, â€˜D-04â€™, â€˜D-05â€™, â€˜D-06â€™];

useEffect(() => {
const load = async () => {
try {
const d = await window.storage.get(â€˜dryer_reportsâ€™, false);
const q = await window.storage.get(â€˜qc_dataâ€™, false);
if (d) setData(JSON.parse(d.value));
if (q) setQcData(JSON.parse(q.value));
} catch (e) {}
};
load();
}, []);

const save = async (newData) => {
setData(newData);
await window.storage.set(â€˜dryer_reportsâ€™, JSON.stringify(newData), false);
};

const saveQc = async (newQc) => {
setQcData(newQc);
await window.storage.set(â€˜qc_dataâ€™, JSON.stringify(newQc), false);
};

const Dashboard = () => {
const today = new Date().toISOString().split(â€˜Tâ€™)[0];

```
return (
  <div className="p-6 max-w-6xl mx-auto">
    <h1 className="text-3xl font-bold mb-6">Dashboard Dryer</h1>
    
    <div className="bg-blue-50 p-4 rounded-lg mb-6">
      <div className="font-semibold mb-2">Pilih Role:</div>
      <div className="flex gap-2">
        <button onClick={() => setRole('mandor')} className={`px-4 py-2 rounded ${role === 'mandor' ? 'bg-blue-600 text-white' : 'bg-white'}`}>
          ğŸ‘· Mandor
        </button>
        <button onClick={() => setRole('qc')} className={`px-4 py-2 rounded ${role === 'qc' ? 'bg-blue-600 text-white' : 'bg-white'}`}>
          ğŸ‘¨â€ğŸ­ QC Pengawas
        </button>
      </div>
    </div>

    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
      {machines.map(m => {
        const key = `${m}_${today}`;
        const report = data[key];
        const qc = qcData[key];
        
        let status = 'Belum Input';
        let color = 'bg-gray-400';
        
        if (report) {
          status = 'Running';
          color = 'bg-blue-500';
        }
        if (qc?.status === 'NORMAL') {
          status = 'Normal';
          color = 'bg-green-500';
        }
        if (qc?.status === 'WARNING') {
          status = 'Warning';
          color = 'bg-red-500';
        }
        
        return (
          <div key={m} onClick={() => { setMachine(m); setPage(role === 'mandor' ? 'input' : 'qc'); }} 
               className="bg-white p-4 rounded-lg shadow cursor-pointer hover:shadow-lg">
            <div className="flex justify-between items-center mb-3">
              <h3 className="text-xl font-bold">{m}</h3>
              <div className={`w-3 h-3 rounded-full ${color}`}></div>
            </div>
            <div className="text-sm space-y-1">
              <div>Status: <b>{status}</b></div>
              {report && <div>Batch: <b>{report.batch || 0}/{report.target || 0}</b></div>}
              {report && <div>Rendemen: <b>{report.rendemen || 0}%</b></div>}
            </div>
          </div>
        );
      })}
    </div>
  </div>
);
```

};

const MandorForm = () => {
const today = new Date().toISOString().split(â€˜Tâ€™)[0];
const key = `${machine}_${today}`;
const existing = data[key] || {};

```
const [f, setF] = useState({
  jenis: existing.jenis || 'Platen',
  platen: existing.platen || '15',
  target: existing.target || '',
  pressTime: existing.pressTime || '',
  bahan: existing.bahan || 'OPC Jawa',
  tebal: existing.tebal || '',
  ukuran: existing.ukuran || '2Ã—4',
  grade: existing.grade || 'A',
  mcL1: existing.mcL1 || '',
  mcL2: existing.mcL2 || '',
  mcL3: existing.mcL3 || '',
  bahanIn: existing.bahanIn || '',
  hasilOut: existing.hasilOut || '',
  batch: existing.batch || '',
  p1: existing.p1 || '',
  p8: existing.p8 || '',
  p15: existing.p15 || '',
  p5: existing.p5 || '',
  p9: existing.p9 || '',
  mc611: existing.mc611 || '',
  mc611t: existing.mc611t || '',
  mc1218: existing.mc1218 || '',
  mc1218t: existing.mc1218t || '',
  mc19: existing.mc19 || '',
  mc19t: existing.mc19t || '',
  press: existing.press || ''
});

const calc = (a, b) => !a || !b || b === '0' ? '0' : ((parseFloat(a) / parseFloat(b)) * 100).toFixed(1);

const submit = () => {
  const rendemen = calc(f.hasilOut, f.bahanIn);
  const sisa = f.bahanIn && f.hasilOut ? (parseFloat(f.bahanIn) - parseFloat(f.hasilOut)).toFixed(2) : '0';
  save({ ...data, [key]: { ...f, rendemen, sisa, machine, time: Date.now() }});
  alert('âœ… Tersimpan!');
};

return (
  <div className="p-6 max-w-4xl mx-auto bg-white rounded-lg shadow">
    <div className="flex justify-between mb-6">
      <h2 className="text-2xl font-bold">Laporan {machine}</h2>
      <button onClick={() => setPage('dashboard')} className="text-blue-600">â† Kembali</button>
    </div>

    <div className="space-y-6">
      <div className="border-b pb-4">
        <h3 className="font-bold mb-3">ğŸ›  Mesin & Proses</h3>
        <div className="grid grid-cols-2 gap-3">
          <div><label className="text-sm">Jenis Mesin</label>
            <select value={f.jenis} onChange={e => setF({...f, jenis: e.target.value})} className="w-full px-3 py-2 border rounded">
              <option>Platen</option><option>Hollow</option>
            </select>
          </div>
          <div><label className="text-sm">Jumlah Platen</label>
            <select value={f.platen} onChange={e => setF({...f, platen: e.target.value})} className="w-full px-3 py-2 border rounded">
              <option>15</option><option>9</option>
            </select>
          </div>
          <div><label className="text-sm">Target Batch</label>
            <input type="number" value={f.target} onChange={e => setF({...f, target: e.target.value})} className="w-full px-3 py-2 border rounded"/>
          </div>
          <div><label className="text-sm">Press Time (mnt)</label>
            <input type="number" value={f.pressTime} onChange={e => setF({...f, pressTime: e.target.value})} className="w-full px-3 py-2 border rounded"/>
          </div>
        </div>
      </div>

      <div className="border-b pb-4">
        <h3 className="font-bold mb-3">ğŸ“¦ Bahan</h3>
        <div className="grid grid-cols-2 gap-3">
          <div><label className="text-sm">Jenis</label>
            <select value={f.bahan} onChange={e => setF({...f, bahan: e.target.value})} className="w-full px-3 py-2 border rounded">
              <option>OPC Jawa</option><option>OPC Sengon</option>
            </select>
          </div>
          <div><label className="text-sm">Tebal</label>
            <input value={f.tebal} onChange={e => setF({...f, tebal: e.target.value})} className="w-full px-3 py-2 border rounded" placeholder="3.4"/>
          </div>
          <div><label className="text-sm">Ukuran</label>
            <select value={f.ukuran} onChange={e => setF({...f, ukuran: e.target.value})} className="w-full px-3 py-2 border rounded">
              <option>2Ã—4</option><option>3Ã—4</option><option>4Ã—4</option>
            </select>
          </div>
          <div><label className="text-sm">Grade</label>
            <select value={f.grade} onChange={e => setF({...f, grade: e.target.value})} className="w-full px-3 py-2 border rounded">
              <option>A</option><option>B</option>
            </select>
          </div>
        </div>
      </div>

      <div className="border-b pb-4">
        <h3 className="font-bold mb-3">ğŸŒ¡ MC Basah</h3>
        <div className="grid grid-cols-3 gap-3">
          <input type="number" value={f.mcL1} onChange={e => setF({...f, mcL1: e.target.value})} placeholder="L1" className="px-3 py-2 border rounded"/>
          <input type="number" value={f.mcL2} onChange={e => setF({...f, mcL2: e.target.value})} placeholder="L2" className="px-3 py-2 border rounded"/>
          <input type="number" value={f.mcL3} onChange={e => setF({...f, mcL3: e.target.value})} placeholder="L3" className="px-3 py-2 border rounded"/>
        </div>
      </div>

      <div className="border-b pb-4">
        <h3 className="font-bold mb-3">ğŸ“ˆ Produksi</h3>
        <div className="grid grid-cols-2 gap-3">
          <div><label className="text-sm">Bahan Tersedia</label>
            <input type="number" value={f.bahanIn} onChange={e => setF({...f, bahanIn: e.target.value})} className="w-full px-3 py-2 border rounded"/>
          </div>
          <div><label className="text-sm">Hasil Dryer</label>
            <input type="number" value={f.hasilOut} onChange={e => setF({...f, hasilOut: e.target.value})} className="w-full px-3 py-2 border rounded"/>
          </div>
          <div><label className="text-sm">Batch</label>
            <input type="number" value={f.batch} onChange={e => setF({...f, batch: e.target.value})} className="w-full px-3 py-2 border rounded"/>
          </div>
          <div><label className="text-sm">Rendemen (%)</label>
            <input value={calc(f.hasilOut, f.bahanIn)} readOnly className="w-full px-3 py-2 border rounded bg-gray-100"/>
          </div>
        </div>
      </div>

      <div className="border-b pb-4">
        <h3 className="font-bold mb-3">ğŸŒ¡ Suhu Platen (Â°C)</h3>
        {f.platen === '15' ? (
          <div className="grid grid-cols-3 gap-3">
            <input type="number" value={f.p1} onChange={e => setF({...f, p1: e.target.value})} placeholder="P1" className="px-3 py-2 border rounded"/>
            <input type="number" value={f.p8} onChange={e => setF({...f, p8: e.target.value})} placeholder="P8" className="px-3 py-2 border rounded"/>
            <input type="number" value={f.p15} onChange={e => setF({...f, p15: e.target.value})} placeholder="P15" className="px-3 py-2 border rounded"/>
          </div>
        ) : (
          <div className="grid grid-cols-3 gap-3">
            <input type="number" value={f.p1} onChange={e => setF({...f, p1: e.target.value})} placeholder="P1" className="px-3 py-2 border rounded"/>
            <input type="number" value={f.p5} onChange={e => setF({...f, p5: e.target.value})} placeholder="P5" className="px-3 py-2 border rounded"/>
            <input type="number" value={f.p9} onChange={e => setF({...f, p9: e.target.value})} placeholder="P9" className="px-3 py-2 border rounded"/>
          </div>
        )}
      </div>

      <div className="border-b pb-4">
        <h3 className="font-bold mb-3">ğŸ” QC Mandor</h3>
        <div className="space-y-2">
          <div className="grid grid-cols-4 gap-2 text-xs font-bold">
            <div>MC</div><div>Jml</div><div>Total</div><div>%</div>
          </div>
          <div className="grid grid-cols-4 gap-2">
            <div className="py-2">6-11</div>
            <input type="number" value={f.mc611} onChange={e => setF({...f, mc611: e.target.value})} className="px-2 py-1 border rounded"/>
            <input type="number" value={f.mc611t} onChange={e => setF({...f, mc611t: e.target.value})} className="px-2 py-1 border rounded"/>
            <input value={calc(f.mc611, f.mc611t)} readOnly className="px-2 py-1 border rounded bg-gray-100 text-sm"/>
          </div>
          <div className="grid grid-cols-4 gap-2">
            <div className="py-2">12-18</div>
            <input type="number" value={f.mc1218} onChange={e => setF({...f, mc1218: e.target.value})} className="px-2 py-1 border rounded"/>
            <input type="number" value={f.mc1218t} onChange={e => setF({...f, mc1218t: e.target.value})} className="px-2 py-1 border rounded"/>
            <input value={calc(f.mc1218, f.mc1218t)} readOnly className="px-2 py-1 border rounded bg-gray-100 text-sm"/>
          </div>
          <div className="grid grid-cols-4 gap-2">
            <div className="py-2">â‰¥19</div>
            <input type="number" value={f.mc19} onChange={e => setF({...f, mc19: e.target.value})} className="px-2 py-1 border rounded"/>
            <input type="number" value={f.mc19t} onChange={e => setF({...f, mc19t: e.target.value})} className="px-2 py-1 border rounded"/>
            <input value={calc(f.mc19, f.mc19t)} readOnly className="px-2 py-1 border rounded bg-gray-100 text-sm"/>
          </div>
          <div><label className="text-sm">Press Ulang (menit)</label>
            <input type="number" value={f.press} onChange={e => setF({...f, press: e.target.value})} className="w-full px-3 py-2 border rounded"/>
          </div>
        </div>
      </div>

      <button onClick={submit} className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700">
        ğŸ’¾ Simpan
      </button>
    </div>
  </div>
);
```

};

const QcForm = () => {
const today = new Date().toISOString().split(â€˜Tâ€™)[0];
const key = `${machine}_${today}`;
const report = data[key];

```
if (!report) {
  return (
    <div className="p-6 max-w-4xl mx-auto bg-white rounded-lg shadow">
      <button onClick={() => setPage('dashboard')} className="text-blue-600 mb-4">â† Kembali</button>
      <div className="text-center py-12 text-gray-500">Belum ada laporan dari Mandor</div>
    </div>
  );
}

const existing = qcData[key] || {};
const [q, setQ] = useState({
  tebalOk: existing.tebalOk !== undefined ? existing.tebalOk : true,
  pressOk: existing.pressOk !== undefined ? existing.pressOk : true,
  suhuOk: existing.suhuOk !== undefined ? existing.suhuOk : true,
  prosesOk: existing.prosesOk !== undefined ? existing.prosesOk : true,
  qp1: existing.qp1 || '',
  qp8: existing.qp8 || '',
  qp15: existing.qp15 || '',
  qp5: existing.qp5 || '',
  qp9: existing.qp9 || '',
  boiler: existing.boiler || '',
  tekanan: existing.tekanan || '',
  batchOk: existing.batchOk !== undefined ? existing.batchOk : true,
  auditOk: existing.auditOk !== undefined ? existing.auditOk : true,
  status: existing.status || 'NORMAL'
});

const getSelisih = () => {
  const temps = report.platen === '15' ? [q.qp1, q.qp8, q.qp15] : [q.qp1, q.qp5, q.qp9];
  const valid = temps.filter(t => t && !isNaN(t)).map(t => parseFloat(t));
  if (valid.length < 2) return 0;
  return Math.max(...valid) - Math.min(...valid);
};

const submit = () => {
  const sel = getSelisih();
  let st = 'NORMAL';
  if (!q.tebalOk || !q.pressOk || !q.suhuOk || !q.prosesOk || sel > 5 || !q.batchOk || !q.auditOk) {
    st = 'WARNING';
  }
  saveQc({ ...qcData, [key]: { ...q, status: st, time: Date.now() }});
  alert('âœ… QC Tersimpan!');
};

const sel = getSelisih();

return (
  <div className="p-6 max-w-4xl mx-auto bg-white rounded-lg shadow">
    <div className="flex justify-between mb-6">
      <h2 className="text-2xl font-bold">QC {machine}</h2>
      <button onClick={() => setPage('dashboard')} className="text-blue-600">â† Kembali</button>
    </div>

    <div className="bg-blue-50 p-4 rounded-lg mb-6">
      <h3 className="font-bold mb-2">ğŸ“‹ Data Mandor</h3>
      <div className="grid grid-cols-2 gap-2 text-sm">
        <div>Bahan: <b>{report.bahan}</b></div>
        <div>Tebal: <b>{report.tebal}</b></div>
        <div>Batch: <b>{report.batch}/{report.target}</b></div>
        <div>Rendemen: <b>{report.rendemen}%</b></div>
      </div>
    </div>

    <div className="space-y-6">
      <div className="border-b pb-4">
        <h3 className="font-bold mb-3">SET 1 - Proses</h3>
        {[
          {label: 'Tebal Bahan', key: 'tebalOk'},
          {label: 'Press Time', key: 'pressOk'},
          {label: 'Suhu Platen', key: 'suhuOk'},
          {label: 'Status Proses', key: 'prosesOk'}
        ].map(item => (
          <div key={item.key} className="flex justify-between items-center p-2 bg-gray-50 rounded mb-2">
            <span className="text-sm font-medium">{item.label}</span>
            <div className="flex gap-2">
              <button onClick={() => setQ({...q, [item.key]: true})} 
                      className={`px-3 py-1 rounded text-sm ${q[item.key] ? 'bg-green-500 text-white' : 'bg-gray-200'}`}>âœ”</button>
              <button onClick={() => setQ({...q, [item.key]: false})} 
                      className={`px-3 py-1 rounded text-sm ${!q[item.key] ? 'bg-red-500 text-white' : 'bg-gray-200'}`}>âœ–</button>
            </div>
          </div>
        ))}

        <div className="mt-4">
          <h4 className="font-semibold mb-2">Suhu QC (Â°C)</h4>
          {report.platen === '15' ? (
            <div className="grid grid-cols-3 gap-3">
              <input type="number" value={q.qp1} onChange={e => setQ({...q, qp1: e.target.value})} placeholder="P1" className="px-3 py-2 border rounded"/>
              <input type="number" value={q.qp8} onChange={e => setQ({...q, qp8: e.target.value})} placeholder="P8" className="px-3 py-2 border rounded"/>
              <input type="number" value={q.qp15} onChange={e => setQ({...q, qp15: e.target.value})} placeholder="P15" className="px-3 py-2 border rounded"/>
            </div>
          ) : (
            <div className="grid grid-cols-3 gap-3">
              <input type="number" value={q.qp1} onChange={e => setQ({...q, qp1: e.target.value})} placeholder="P1" className="px-3 py-2 border rounded"/>
              <input type="number" value={q.qp5} onChange={e => setQ({...q, qp5: e.target.value})} placeholder="P5" className="px-3 py-2 border rounded"/>
              <input type="number" value={q.qp9} onChange={e => setQ({...q, qp9: e.target.value})} placeholder="P9" className="px-3 py-2 border rounded"/>
            </div>
          )}
          <div className={`mt-3 p-3 rounded ${sel > 5 ? 'bg-red-100' : 'bg-green-100'}`}>
            <div className="text-sm font-bold">Selisih: {sel.toFixed(1)}Â°C {sel <= 5 ? 'âœ” Aman' : 'âš  Risiko'}</div>
          </div>
        </div>

        <div className="grid grid-cols-2 gap-3 mt-4">
          <div><label className="text-sm">Boiler (Â°C)</label>
            <input type="number" value={q.boiler} onChange={e => setQ({...q, boiler: e.target.value})} className="w-full px-3 py-2 border rounded"/>
          </div>
          <div><label className="text-sm">Tekanan</label>
            <input value={q.tekanan} onChange={e => setQ({...q, tekanan: e.target.value})} className="w-full px-3 py-2 border rounded"/>
          </div>
        </div>
      </div>

      <div className="border-b pb-4">
        <h3 className="font-bold mb-3">SET 2 - Validasi</h3>
        <div className="space-y-2">
          <div className="flex justify-between items-center p-2 bg-gray-50 rounded">
            <span className="text-sm font-medium">Per Batch</span>
            <div className="flex gap-2">
              <button onClick={() => setQ({...q, batchOk: true})} 
                      className={`px-3 py-1 rounded text-sm ${q.batchOk ? 'bg-green-500 text-white' : 'bg-gray-200'}`}>âœ” Sesuai</button>
              <button onClick={() => setQ({...q, batchOk: false})} 
                      className={`px-3 py-1 rounded text-sm ${!q.batchOk ? 'bg-red-500 text-white' : 'bg-gray-200'}`}>âœ– Tidak</button>
            </div>
          </div>
          <div className="flex justify-between items-center p-2 bg-gray-50 rounded">
            <span className="text-sm font-medium">Audit Output</span>
            <div className="flex gap-2">
              <button onClick={() => setQ({...q, auditOk: true})} 
                      className={`px-3 py-1 rounded text-sm ${q.auditOk ? 'bg-green-500 text-white' : 'bg-gray-200'}`}>âœ” Sesuai</button>
              <button onClick={() => setQ({...q, auditOk: false})} 
                      className={`px-3 py-1 rounded text-sm ${!q.auditOk ? 'bg-red-500 text-white' : 'bg-gray-200'}`}>âœ– Tidak</button>
            </div>
          </div>
        </div>
      </div>

      <button onClick={submit} className="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700">
        âœ… Simpan QC
      </button>
    </div>
  </div>
);
```

};

return (
<div className="min-h-screen bg-gray-100">
{page === â€˜dashboardâ€™ && <Dashboard />}
{page === â€˜inputâ€™ && <MandorForm />}
{page === â€˜qcâ€™ && <QcForm />}
</div>
);
};

export default DryerReportApp;
