import React, { useState, useEffect } from ‘react’;

const DryerApp = () => {
const [view, setView] = useState(‘home’);
const [role, setRole] = useState(‘mandor’);
const [selectedMachine, setSelectedMachine] = useState(’’);
const [reports, setReports] = useState({});
const [qcData, setQcData] = useState({});

useEffect(() => {
loadData();
}, []);

const loadData = async () => {
try {
const r = await window.storage.get(‘reports’, false);
const q = await window.storage.get(‘qc’, false);
if (r) setReports(JSON.parse(r.value));
if (q) setQcData(JSON.parse(q.value));
} catch (e) {
console.log(‘No data’);
}
};

const saveReport = async (key, data) => {
const newReports = { …reports, [key]: data };
setReports(newReports);
await window.storage.set(‘reports’, JSON.stringify(newReports), false);
};

const saveQc = async (key, data) => {
const newQc = { …qcData, [key]: data };
setQcData(newQc);
await window.storage.set(‘qc’, JSON.stringify(newQc), false);
};

const Dashboard = () => {
const machines = [‘D-01’, ‘D-02’, ‘D-03’, ‘D-04’, ‘D-05’, ‘D-06’];
const today = new Date().toISOString().split(‘T’)[0];

```
return (
  <div className="p-4">
    <h1 className="text-2xl font-bold mb-4">Dashboard Dryer</h1>
    
    <div className="bg-blue-100 p-3 rounded mb-4">
      <div className="font-semibold mb-2">Role:</div>
      <div className="flex gap-2">
        <button 
          onClick={() => setRole('mandor')}
          className={`px-4 py-2 rounded ${role === 'mandor' ? 'bg-blue-600 text-white' : 'bg-white'}`}>
          Mandor
        </button>
        <button 
          onClick={() => setRole('qc')}
          className={`px-4 py-2 rounded ${role === 'qc' ? 'bg-blue-600 text-white' : 'bg-white'}`}>
          QC
        </button>
      </div>
    </div>

    <div className="grid grid-cols-2 gap-3">
      {machines.map(m => {
        const key = `${m}_${today}`;
        const report = reports[key];
        const qc = qcData[key];
        let color = 'bg-gray-400';
        let status = 'Idle';
        
        if (report) {
          color = 'bg-blue-500';
          status = 'Running';
        }
        if (qc?.ok) {
          color = 'bg-green-500';
          status = 'OK';
        }
        if (qc?.warning) {
          color = 'bg-red-500';
          status = 'Warning';
        }

        return (
          <div 
            key={m}
            onClick={() => {
              setSelectedMachine(m);
              setView(role === 'mandor' ? 'input' : 'qc');
            }}
            className="bg-white p-3 rounded shadow cursor-pointer">
            <div className="flex justify-between mb-2">
              <span className="font-bold">{m}</span>
              <div className={`w-3 h-3 rounded-full ${color}`}></div>
            </div>
            <div className="text-sm">{status}</div>
            {report && <div className="text-xs">Batch: {report.batch}/{report.target}</div>}
          </div>
        );
      })}
    </div>
  </div>
);
```

};

const InputForm = () => {
const today = new Date().toISOString().split(‘T’)[0];
const key = `${selectedMachine}_${today}`;
const existing = reports[key] || {};

```
const [form, setForm] = useState({
  target: existing.target || '',
  press: existing.press || '',
  bahan: existing.bahan || 'OPC Jawa',
  tebal: existing.tebal || '',
  ukuran: existing.ukuran || '2x4',
  mcL1: existing.mcL1 || '',
  mcL2: existing.mcL2 || '',
  mcL3: existing.mcL3 || '',
  bahanIn: existing.bahanIn || '',
  hasilOut: existing.hasilOut || '',
  batch: existing.batch || '',
  p1: existing.p1 || '',
  p8: existing.p8 || '',
  p15: existing.p15 || '',
  mc611: existing.mc611 || '',
  mc1218: existing.mc1218 || '',
  mc19: existing.mc19 || ''
});

const handleSave = () => {
  const rendemen = form.bahanIn && form.hasilOut 
    ? ((parseFloat(form.hasilOut) / parseFloat(form.bahanIn)) * 100).toFixed(1)
    : '0';
  
  saveReport(key, { ...form, rendemen });
  alert('Tersimpan!');
  setView('home');
};

return (
  <div className="p-4 max-w-2xl mx-auto">
    <div className="flex justify-between mb-4">
      <h2 className="text-xl font-bold">Input {selectedMachine}</h2>
      <button onClick={() => setView('home')} className="text-blue-600">Kembali</button>
    </div>

    <div className="space-y-4">
      <div className="bg-white p-4 rounded shadow">
        <h3 className="font-bold mb-3">Mesin</h3>
        <div className="grid grid-cols-2 gap-3">
          <input 
            placeholder="Target Batch" 
            type="number"
            value={form.target}
            onChange={e => setForm({...form, target: e.target.value})}
            className="border p-2 rounded w-full" />
          <input 
            placeholder="Press Time (mnt)" 
            type="number"
            value={form.press}
            onChange={e => setForm({...form, press: e.target.value})}
            className="border p-2 rounded w-full" />
        </div>
      </div>

      <div className="bg-white p-4 rounded shadow">
        <h3 className="font-bold mb-3">Bahan</h3>
        <div className="grid grid-cols-2 gap-3">
          <select 
            value={form.bahan}
            onChange={e => setForm({...form, bahan: e.target.value})}
            className="border p-2 rounded">
            <option>OPC Jawa</option>
            <option>OPC Sengon</option>
          </select>
          <input 
            placeholder="Tebal" 
            value={form.tebal}
            onChange={e => setForm({...form, tebal: e.target.value})}
            className="border p-2 rounded" />
          <select 
            value={form.ukuran}
            onChange={e => setForm({...form, ukuran: e.target.value})}
            className="border p-2 rounded">
            <option>2×4</option>
            <option>3×4</option>
            <option>4×4</option>
          </select>
        </div>
      </div>

      <div className="bg-white p-4 rounded shadow">
        <h3 className="font-bold mb-3">MC Basah</h3>
        <div className="grid grid-cols-3 gap-2">
          <input 
            placeholder="L1" 
            type="number"
            value={form.mcL1}
            onChange={e => setForm({...form, mcL1: e.target.value})}
            className="border p-2 rounded" />
          <input 
            placeholder="L2" 
            type="number"
            value={form.mcL2}
            onChange={e => setForm({...form, mcL2: e.target.value})}
            className="border p-2 rounded" />
          <input 
            placeholder="L3" 
            type="number"
            value={form.mcL3}
            onChange={e => setForm({...form, mcL3: e.target.value})}
            className="border p-2 rounded" />
        </div>
      </div>

      <div className="bg-white p-4 rounded shadow">
        <h3 className="font-bold mb-3">Produksi</h3>
        <div className="grid grid-cols-2 gap-3">
          <input 
            placeholder="Bahan Tersedia" 
            type="number"
            value={form.bahanIn}
            onChange={e => setForm({...form, bahanIn: e.target.value})}
            className="border p-2 rounded" />
          <input 
            placeholder="Hasil Dryer" 
            type="number"
            value={form.hasilOut}
            onChange={e => setForm({...form, hasilOut: e.target.value})}
            className="border p-2 rounded" />
          <input 
            placeholder="Batch" 
            type="number"
            value={form.batch}
            onChange={e => setForm({...form, batch: e.target.value})}
            className="border p-2 rounded" />
          <input 
            placeholder="Rendemen %" 
            value={form.bahanIn && form.hasilOut 
              ? ((parseFloat(form.hasilOut) / parseFloat(form.bahanIn)) * 100).toFixed(1)
              : '0'}
            readOnly
            className="border p-2 rounded bg-gray-100" />
        </div>
      </div>

      <div className="bg-white p-4 rounded shadow">
        <h3 className="font-bold mb-3">Suhu Platen (°C)</h3>
        <div className="grid grid-cols-3 gap-2">
          <input 
            placeholder="P1" 
            type="number"
            value={form.p1}
            onChange={e => setForm({...form, p1: e.target.value})}
            className="border p-2 rounded" />
          <input 
            placeholder="P8" 
            type="number"
            value={form.p8}
            onChange={e => setForm({...form, p8: e.target.value})}
            className="border p-2 rounded" />
          <input 
            placeholder="P15" 
            type="number"
            value={form.p15}
            onChange={e => setForm({...form, p15: e.target.value})}
            className="border p-2 rounded" />
        </div>
      </div>

      <div className="bg-white p-4 rounded shadow">
        <h3 className="font-bold mb-3">QC Mandor (%)</h3>
        <div className="space-y-2">
          <div className="flex gap-2">
            <span className="w-16 py-2">MC 6-11</span>
            <input 
              placeholder="%" 
              type="number"
              value={form.mc611}
              onChange={e => setForm({...form, mc611: e.target.value})}
              className="border p-2 rounded flex-1" />
          </div>
          <div className="flex gap-2">
            <span className="w-16 py-2">MC 12-18</span>
            <input 
              placeholder="%" 
              type="number"
              value={form.mc1218}
              onChange={e => setForm({...form, mc1218: e.target.value})}
              className="border p-2 rounded flex-1" />
          </div>
          <div className="flex gap-2">
            <span className="w-16 py-2">MC ≥19</span>
            <input 
              placeholder="%" 
              type="number"
              value={form.mc19}
              onChange={e => setForm({...form, mc19: e.target.value})}
              className="border p-2 rounded flex-1" />
          </div>
        </div>
      </div>

      <button 
        onClick={handleSave}
        className="w-full bg-blue-600 text-white py-3 rounded font-bold">
        Simpan
      </button>
    </div>
  </div>
);
```

};

const QcForm = () => {
const today = new Date().toISOString().split(‘T’)[0];
const key = `${selectedMachine}_${today}`;
const report = reports[key];

```
if (!report) {
  return (
    <div className="p-4">
      <button onClick={() => setView('home')} className="text-blue-600 mb-4">Kembali</button>
      <div className="text-center py-12">Belum ada laporan</div>
    </div>
  );
}

const existing = qcData[key] || {};
const [qc, setQc] = useState({
  tebal: existing.tebal !== undefined ? existing.tebal : true,
  press: existing.press !== undefined ? existing.press : true,
  suhu: existing.suhu !== undefined ? existing.suhu : true,
  proses: existing.proses !== undefined ? existing.proses : true,
  batch: existing.batch !== undefined ? existing.batch : true,
  audit: existing.audit !== undefined ? existing.audit : true
});

const handleSave = () => {
  const allOk = qc.tebal && qc.press && qc.suhu && qc.proses && qc.batch && qc.audit;
  saveQc(key, { ...qc, ok: allOk, warning: !allOk });
  alert('QC tersimpan!');
  setView('home');
};

return (
  <div className="p-4 max-w-2xl mx-auto">
    <div className="flex justify-between mb-4">
      <h2 className="text-xl font-bold">QC {selectedMachine}</h2>
      <button onClick={() => setView('home')} className="text-blue-600">Kembali</button>
    </div>

    <div className="bg-blue-50 p-3 rounded mb-4">
      <div className="text-sm"><b>Bahan:</b> {report.bahan}</div>
      <div className="text-sm"><b>Batch:</b> {report.batch}/{report.target}</div>
      <div className="text-sm"><b>Rendemen:</b> {report.rendemen}%</div>
    </div>

    <div className="space-y-3">
      {[
        {label: 'Tebal Bahan', key: 'tebal'},
        {label: 'Press Time', key: 'press'},
        {label: 'Suhu Platen', key: 'suhu'},
        {label: 'Status Proses', key: 'proses'},
        {label: 'Per Batch', key: 'batch'},
        {label: 'Audit Output', key: 'audit'}
      ].map(item => (
        <div key={item.key} className="bg-white p-3 rounded shadow flex justify-between items-center">
          <span className="font-medium">{item.label}</span>
          <div className="flex gap-2">
            <button 
              onClick={() => setQc({...qc, [item.key]: true})}
              className={`px-4 py-1 rounded ${qc[item.key] ? 'bg-green-500 text-white' : 'bg-gray-200'}`}>
              ✓
            </button>
            <button 
              onClick={() => setQc({...qc, [item.key]: false})}
              className={`px-4 py-1 rounded ${!qc[item.key] ? 'bg-red-500 text-white' : 'bg-gray-200'}`}>
              ✗
            </button>
          </div>
        </div>
      ))}
    </div>

    <button 
      onClick={handleSave}
      className="w-full bg-green-600 text-white py-3 rounded font-bold mt-4">
      Simpan QC
    </button>
  </div>
);
```

};

return (
<div className="min-h-screen bg-gray-100">
{view === ‘home’ && <Dashboard />}
{view === ‘input’ && <InputForm />}
{view === ‘qc’ && <QcForm />}
</div>
);
};

export default DryerApp;
